module.exports=function(){this.root=null;var NodeDefinition=function(key,value){this.key=key,this.value=value,this.left=null,this.right=null},DeepestNode=function(){var deepestLevel=0,deepestNode=null,caculate=function(node,level){null!=node&&(caculate(node.left,++level),level>deepestLevel&&(deepestNode=node,deepestLevel=level),caculate(node.right,++level))};this.find=function(node){return caculate(node,0),deepestNode}};this.contains=function(key){return null!=this.getNode(key)},this.get=function(key){var node=this.getNode(key);return null!=node?node.value:null},this.getNode=function(key){var node=this.splay(this.root,key);return null!=node&&(this.root=node,this.root.key===key)?this.root:null},this.add=function(key,value){if(null==this.root)return void(this.root=new NodeDefinition(key,value));if(this.root=this.splay(this.root,key),key<this.root.key){var node=new NodeDefinition(key,value);node.left=this.root.left,node.right=this.root,this.root.left=null,this.root=node}else if(key>this.root.key){var node=new NodeDefinition(key,value);node.right=this.root.right,node.left=this.root,this.root.right=null,this.root=node}else this.root.value=value},this.remove=function(key){if(null!=this.root&&this.root.key===key)if(null==this.root.left)this.root=this.root.right;else{var node=this.root.right;this.root=this.root.left,this.splay(this.root,key),this.root.right=node}},this.splay=function(node,key){if(null==node)return null;if(key<node.key){if(null==node.left)return node;key<node.left.key?(node.left.left=this.splay(node.left.left,key),node=this.rotateRight(node)):key>node.left.key&&(node.left.right=this.splay(node.left.right,key),null!=node.left.right&&(node.left=this.rotateLeft(node.left))),null!=node.left&&(node=this.rotateRight(node))}else if(key>node.key){if(null==node.right)return node;key<node.right.key?(node.right.left=this.splay(node.right.left,key),null!=node.right.left&&(node.right=this.rotateRight(node.right))):key>node.right.key&&(node.right.right=this.splay(node.right.right,key),node=this.rotateLeft(node)),null!=node.right&&(node=this.rotateLeft(node))}return node},this.splayDeepest=function(node){var deepestNodeFinder=new DeepestNode,node=deepestNodeFinder.find(this.root);null!=node&&this.get(node.key)},this.getSize=function(){return this.getSubTreeSize(this.root)},this.getSubTreeSize=function(node){return null==node?0:1+this.getSubTreeSize(node.left)+this.getSubTreeSize(node.right)},this.rotateLeft=function(node){if(null==node||null==node.right)return node;var right=node.right;return node.right=right.left,right.left=node,right},this.rotateRight=function(node){if(null==node||null==node.left)return node;var left=node.left;return node.left=left.right,left.right=node,left}};
